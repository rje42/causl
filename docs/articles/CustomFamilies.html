<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Custom Families • causl</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Custom Families">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">causl</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.10.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/AMR-Comparison.html">Illustrating Estimator AMR</a>
    </li>
    <li>
      <a href="../articles/Comparison.html">Comparison of Methods</a>
    </li>
    <li>
      <a href="../articles/CopulaSimulation.html">Copula Simulation</a>
    </li>
    <li>
      <a href="../articles/CustomFamilies.html">Custom Families</a>
    </li>
    <li>
      <a href="../articles/Discrete_Variables_Copula.html">Discrete Variables Copula</a>
    </li>
    <li>
      <a href="../articles/Families.html">Families, link functions and parameters</a>
    </li>
    <li>
      <a href="../articles/Hidden_Variables.html">Hidden Variables</a>
    </li>
    <li>
      <a href="../articles/HTEs.html">Heterogeneous TEs</a>
    </li>
    <li>
      <a href="../articles/Inversion.html">Inversion Tutorial</a>
    </li>
    <li>
      <a href="../articles/Plasmode.html">Plasmode Simulation</a>
    </li>
    <li>
      <a href="../articles/PowerCalculations.html">Inversion Tutorial</a>
    </li>
    <li>
      <a href="../articles/Simple-Copula-Parametrization.html">Specifying Copula Models through Correlation</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Custom Families</h1>
                        <h4 data-toc-skip class="author">Robin
Evans</h4>
            
            <h4 data-toc-skip class="date">2025-08-26</h4>
      

      <div class="hidden name"><code>CustomFamilies.Rmd</code></div>

    </div>

    
    
<p>The <code>causl</code> package now allows users to specify custom
families with which to perform their simulations. To do this, one must
create a function that takes as an argument the link function, and
returns a list containing:</p>
<ul>
<li>
<code>name</code>: the name of the relevant family;</li>
<li>
<code>ddist</code>: a function returning the density of the
distributions;</li>
<li>
<code>qdist</code>: a function returning the quantiles from
probabilities;</li>
<li>
<code>rdist</code>: a function to sample values from the
distribution;</li>
<li>
<code>pdist</code>: a cumulative distribution function;</li>
<li>
<code>pars</code>: a list of the names of the parameters used;</li>
<li>
<code>default</code>: a function that returns a list of the default
values for an observation and each of the parameters;</li>
<li>
<code>link</code>: the specified link function.</li>
</ul>
<p>The function should also give the output the class
<code>"causl_family"</code>, so that it is interpreted
appropriately.</p>
<div class="section level2">
<h2 id="example-poisson-distribution">Example (Poisson distribution)<a class="anchor" aria-label="anchor" href="#example-poisson-distribution"></a>
</h2>
<p>Suppose we wish to simulate from a Poisson distribution as part of a
frugal model. Then we can define a function such as the below:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">causl</span><span class="op">)</span></span>
<span></span>
<span><span class="va">poisson_causl_fam</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span><span class="va">link</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/missing.html" class="external-link">missing</a></span><span class="op">(</span><span class="va">link</span><span class="op">)</span><span class="op">)</span> <span class="va">link</span> <span class="op">=</span> <span class="st">"log"</span></span>
<span></span>
<span>  <span class="co">## write functions</span></span>
<span>  <span class="va">dens</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span><span class="va">x</span>, <span class="va">mu</span>, <span class="va">log</span><span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">dpois</a></span><span class="op">(</span><span class="va">x</span>, lambda<span class="op">=</span><span class="va">mu</span>, log<span class="op">=</span><span class="va">log</span><span class="op">)</span></span>
<span>  <span class="va">quan</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span><span class="va">p</span>, <span class="va">mu</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">qpois</a></span><span class="op">(</span><span class="va">p</span>, lambda<span class="op">=</span><span class="va">mu</span><span class="op">)</span></span>
<span>  <span class="va">sim</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span><span class="va">n</span>, <span class="va">mu</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">qx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span>    <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">qpois</a></span><span class="op">(</span><span class="va">qx</span>, lambda<span class="op">=</span><span class="va">mu</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"quantile"</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">qx</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">probs</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span><span class="va">x</span>, <span class="va">mu</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">ppois</a></span><span class="op">(</span><span class="va">x</span>, lambda<span class="op">=</span><span class="va">mu</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">default</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">theta</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>x<span class="op">=</span><span class="fl">1</span>, mu<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co">## define family</span></span>
<span>  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>name<span class="op">=</span><span class="st">"poisson"</span>, ddist<span class="op">=</span><span class="va">dens</span>, qdist<span class="op">=</span><span class="va">quan</span>, rdist<span class="op">=</span><span class="va">sim</span>, pdist<span class="op">=</span><span class="va">probs</span>,</span>
<span>              pars<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mu"</span><span class="op">)</span>, default<span class="op">=</span><span class="va">default</span>, link<span class="op">=</span><span class="va">link</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"causl_family"</span></span>
<span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Some remarks are in order. Note that the <code>ddist</code> function
must have a <code>log</code> argument to allow the log-density to be
evaluated. In addition, since this is a discrete distribution, if we use
it in a copula we must know the exact quantile used in the simulation
(not just the one returned by applying <code>ppois</code>). Hence we
simulate a uniform and then obtain the Poisson random variables by
inversion from <code>qpois</code>. For continuous distributions this is
unnecessary, and <code>glm_sim</code> will just apply the
<code>pdist</code> function.</p>
<p>Now, let us try to simulate some data using this distribution. We
will need to use <code>poisson_causl_fam</code> in our
<code>family</code> argument:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">forms</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">Z</span> <span class="op">~</span> <span class="fl">1</span>, <span class="va">X</span> <span class="op">~</span> <span class="va">Z</span>, <span class="va">Y</span> <span class="op">~</span> <span class="va">X</span>, <span class="op">~</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">fams</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu">poisson_causl_fam</span><span class="op">(</span><span class="op">)</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">pars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Z <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>beta <span class="op">=</span> <span class="fl">0</span>, phi <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>             X <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>beta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.3</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>             Y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>beta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">0.5</span><span class="op">)</span>, phi <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>             cop <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>beta <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">cm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/causl_model.html">causl_model</a></span><span class="op">(</span>formulas <span class="op">=</span> <span class="va">forms</span>, family <span class="op">=</span> <span class="va">fams</span>, pars <span class="op">=</span> <span class="va">pars</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rfrugal.html">rfrugal</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">1e3</span>, causl_model<span class="op">=</span><span class="va">cm</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Inversion method selected: using pair-copula parameterization</span></span></code></pre>
<div class="section level3">
<h3 id="treatment-model">Treatment model<a class="anchor" aria-label="anchor" href="#treatment-model"></a>
</h3>
<p>Then we can check that the new variables have been simulated
correctly. We ought to have:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>X</mi><mo>=</mo><mi>x</mi><mo>∣</mo><mi>z</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mfrac><mn>1</mn><mrow><mi>x</mi><mi>!</mi></mrow></mfrac><mo>exp</mo><mo stretchy="false" form="prefix">{</mo><msub><mi>α</mi><mn>0</mn></msub><mo>+</mo><msub><mi>α</mi><mn>1</mn></msub><mi>z</mi><mi>x</mi><mo>−</mo><msup><mi>e</mi><mrow><msub><mi>α</mi><mn>0</mn></msub><mo>+</mo><msub><mi>α</mi><mn>1</mn></msub><mi>z</mi></mrow></msup><mo stretchy="false" form="postfix">}</mo><mo>,</mo></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align*}
P(X = x \mid z) &amp;= \frac{1}{x!} \exp\{\alpha_0 + \alpha_1 z x - e^{\alpha_0 + \alpha_1 z}\}, 
\end{align*}</annotation></semantics></math> with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>=</mo><mn>0.3</mn></mrow><annotation encoding="application/x-tex">\alpha = 0.3</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>α</mi><mn>1</mn></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\alpha_1 = 1</annotation></semantics></math>.
Let’s perform a regression to check the parameters:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">modX</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">X</span> <span class="op">~</span> <span class="va">Z</span>, family<span class="op">=</span><span class="va">quasipoisson</span>, data<span class="op">=</span><span class="va">dat</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">modX</span><span class="op">)</span><span class="op">$</span><span class="va">coefficients</span></span></code></pre></div>
<pre><code><span><span class="co">##             Estimate Std. Error t value  Pr(&gt;|t|)</span></span>
<span><span class="co">## (Intercept)    0.286     0.0312    9.19  2.30e-19</span></span>
<span><span class="co">## Z              1.019     0.0219   46.63 7.38e-253</span></span></code></pre>
<p>So we can see that the estimates are well within two standard errors
of the true value. In addition,</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">modX</span><span class="op">)</span><span class="op">$</span><span class="va">dispersion</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 1.06</span></span></code></pre>
<p>the dispersion parameter is close to its nominal value of 1.</p>
</div>
<div class="section level3">
<h3 id="outcome-model">Outcome model<a class="anchor" aria-label="anchor" href="#outcome-model"></a>
</h3>
<p>We can also fit the outcome model using maximum likelihood estimation
with sandwich errors.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_causl.html">fit_causl</a></span><span class="op">(</span>dat <span class="op">=</span> <span class="va">dat</span>, formulas <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">X</span>, <span class="va">Z</span> <span class="op">~</span> <span class="fl">1</span>, <span class="va">cop</span> <span class="op">~</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>                 family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>This gives us estimates of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>β</mi><mn>0</mn></msub><mo>=</mo><mi>−</mi><mn>0.886</mn></mrow><annotation encoding="application/x-tex">\beta_0 = -0.886</annotation></semantics></math>
(0.042) and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>β</mi><mn>1</mn></msub><mo>=</mo><mn>0.457</mn></mrow><annotation encoding="application/x-tex">\beta_1 = 0.457</annotation></semantics></math>
(0.011), which is consistent with the values
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>−</mi><mn>1</mn></mrow><annotation encoding="application/x-tex">-1</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0.5</mn><annotation encoding="application/x-tex">0.5</annotation></semantics></math>
that we used to simulate.</p>
<!-- We can also attempt to infer the causal effect of $X$ on $Y$: -->
<!-- ```{r fitX} -->
<!-- eta <- c(cbind(1,dat$Z) %*% modX$coefficients) -->
<!-- gps <- dpois(dat$X, lambda=exp(eta)) -->
<!-- mean((dat$Y/gps)*(dat$X==1)) - mean((dat$Y/gps)*(dat$X==0)) -->
<!-- mean((dat$Y/gps)*(dat$X==2)) - mean((dat$Y/gps)*(dat$X==1)) -->
<!-- mean((dat$Y/gps)*(dat$X==3)) - mean((dat$Y/gps)*(dat$X==2)) -->
<!-- mean((dat$Y/gps)*(dat$X==4)) - mean((dat$Y/gps)*(dat$X==3)) -->
<!-- ``` -->
</div>
</div>
<div class="section level2">
<h2 id="custom-link-functions">Custom Link Functions<a class="anchor" aria-label="anchor" href="#custom-link-functions"></a>
</h2>
<p>The example above works because <code>log</code> is an existing link
function specified in the package. Suppose, however, that we want to use
the <code>sqrt</code> function as the link; this is not used with any
built-in families.</p>
<p>For this we need to specify a <code>custom_links</code> argument to
<code>poisson_causl_fam</code>; each entry in this named list should
itself be a list, containing:</p>
<ul>
<li>
<code>linkfun</code>: the link function
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>g</mi><annotation encoding="application/x-tex">g</annotation></semantics></math>;</li>
<li>
<code>linkinv</code>: the inverse of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>g</mi><annotation encoding="application/x-tex">g</annotation></semantics></math>.</li>
</ul>
<p>The names of the entries should correspond to the string used as the
name of the link function.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="va">poisson_causl_fam</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span><span class="va">link</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/missing.html" class="external-link">missing</a></span><span class="op">(</span><span class="va">link</span><span class="op">)</span><span class="op">)</span> <span class="va">link</span> <span class="op">=</span> <span class="st">"log"</span></span>
<span></span>
<span>  <span class="co">## write functions</span></span>
<span>  <span class="va">dens</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span><span class="va">x</span>, <span class="va">mu</span>, <span class="va">log</span><span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">dpois</a></span><span class="op">(</span><span class="va">x</span>, lambda<span class="op">=</span><span class="va">mu</span>, log<span class="op">=</span><span class="va">log</span><span class="op">)</span></span>
<span>  <span class="va">quan</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span><span class="va">p</span>, <span class="va">mu</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">qpois</a></span><span class="op">(</span><span class="va">p</span>, lambda<span class="op">=</span><span class="va">mu</span><span class="op">)</span></span>
<span>  <span class="va">sim</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span><span class="va">n</span>, <span class="va">mu</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">qx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span>    <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">qpois</a></span><span class="op">(</span><span class="va">qx</span>, lambda<span class="op">=</span><span class="va">mu</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"quantile"</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">qx</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">probs</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span><span class="va">x</span>, <span class="va">mu</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">ppois</a></span><span class="op">(</span><span class="va">x</span>, lambda<span class="op">=</span><span class="va">mu</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">default</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">theta</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>x<span class="op">=</span><span class="fl">1</span>, mu<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">custom_links</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>sqrt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>linkfun <span class="op">=</span> <span class="kw">function</span> <span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>                                   linkinv <span class="op">=</span> <span class="kw">function</span> <span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co">## define family</span></span>
<span>  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>name<span class="op">=</span><span class="st">"poisson"</span>, ddist<span class="op">=</span><span class="va">dens</span>, qdist<span class="op">=</span><span class="va">quan</span>, rdist<span class="op">=</span><span class="va">sim</span>, pdist<span class="op">=</span><span class="va">probs</span>,</span>
<span>              pars<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mu"</span><span class="op">)</span>, default<span class="op">=</span><span class="va">default</span>, link<span class="op">=</span><span class="va">link</span>, custom_links<span class="op">=</span><span class="va">custom_links</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"causl_family"</span></span>
<span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Now we can suitably modify our earlier example:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fams</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu">poisson_causl_fam</span><span class="op">(</span>link<span class="op">=</span><span class="st">"sqrt"</span><span class="op">)</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">pars</span><span class="op">$</span><span class="va">X</span><span class="op">$</span><span class="va">beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.9</span>, <span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="va">cm_sq</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/modify.html">modify</a></span><span class="op">(</span><span class="va">cm</span>, family<span class="op">=</span><span class="va">fams</span>, pars<span class="op">=</span><span class="va">pars</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">124</span><span class="op">)</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rfrugal.html">rfrugal</a></span><span class="op">(</span><span class="fl">1e3</span>, causl_model <span class="op">=</span> <span class="va">cm_sq</span>, control<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>quiet<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We can again check that the distribution was correctly sampled.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">modX</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">X</span> <span class="op">~</span> <span class="va">Z</span>, family<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">quasipoisson</a></span><span class="op">(</span><span class="va">sqrt</span><span class="op">)</span>, data<span class="op">=</span><span class="va">dat</span>, start<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">modX</span><span class="op">)</span><span class="op">$</span><span class="va">coefficients</span></span></code></pre></div>
<pre><code><span><span class="co">##             Estimate Std. Error t value Pr(&gt;|t|)</span></span>
<span><span class="co">## (Intercept)   1.5527     0.0161   96.22 0.00e+00</span></span>
<span><span class="co">## Z             0.0775     0.0165    4.71 2.86e-06</span></span></code></pre>
<p>So we again see that the estimates are (just about) within two
standard errors of the true values (0.9 and 0.05), and the dispersion
parameter is estimated to be 1.037, again close to 1.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Robin Evans, Xi Lin.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

      </footer>
</div>






  </body>
</html>
